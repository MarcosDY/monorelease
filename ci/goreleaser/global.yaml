version: 2

env:
  - GHCR_REPO=ghcr.io/marcosdy
  - PUBLIC_S3_BUCKET=monorepo-releases

nightly:
  version_template: "{{ .Version }}-{{ .ShortCommit }}-dev"

git:
  tag_sort: semver
  ignore_tag_prefixes:
    - baz-test-helm
    - baz-test-helm

# before_publish:
  # - cmd: "./scripts/post-process-release-notes.sh"
    # output: true

# before:
  # hooks:
    # - cmd: "./scripts/post-process-release-notes.sh"
      # output: true
    #  Generate the release notes using our custom tool so they can be displayed in GH releases
    # - cmd: >-
        # go run ./deploy/create-release-notes
        # --component {{ envOrDefault "RELEASE_NOTES_COMPONENT" .ProjectName }}
        # --output-file ./tmp/{{ .ProjectName }}-release-notes.md
        # --latest-tag {{if .IsRelease}}{{ .PrefixedTag }}{{ else }}HEAD{{ end }}
      # env:
        # - GITHUB_TOKEN={{ .Env.GITHUB_TOKEN }}
      # if: "{{ .IsRelease }}"

after:
  hooks:
    - cmd: "./scripts/post-process-release-notes.sh"
      output: true

release:
  prerelease: auto
  name_template: "{{ envOrDefault \"RELEASE_NOTES_COMPONENT\" .ProjectName }}-v{{.Version}}"
  skip_upload: true
  mode: replace
  header: |
    ## Some title ({{ .Date }})

    Welcome to this new release!
  # header:
    # from_file:
      # path: "a-release-notes.md"
  footer: |
    ## Thanks

    Those were the changes on {{ .Tag }}!

